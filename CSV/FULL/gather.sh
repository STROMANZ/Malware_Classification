#!/bin/bash

if [ ! -f virus.index ]; then
	find /data/research/DATASET/ -type f -name VirusShare_* > virus.index
fi

for i in `ls FULL-*.csv`
do
	dirname=$(echo ${i} | awk -F\- '{print $3}' | sed 's,.csv$,,g')
	
	if [ ! -d $dirname ]; then
		mkdir ${dirname}
	fi

	for md5 in `cat ${i} | awk -F\, '{print $1}' |  grep -v ^md5$`
	do
		cp $(grep ${md5} virus.index) ${dirname}
	done

	zip --quiet -rm -s 50m -e -P infected ${dirname}.zip ${dirname}
done
