#!/bin/bash

SUMMARY="results.json"
if [ -f ${SUMMARY} ];then
	echo "${SUMMARY} exists"

	while x=x;
	do
		read -p "Type \"OK\" to overwrite: "
		if [ ${REPLY} == "OK" ];then 
			> ${SUMMARY}
			break
		fi
	done
fi	

getsums(){
	QUERYFILES="./VirusShare_*"
	for i in `ls ${QUERYFILES}`
	do
		echo ${i} | awk -F\_ '{print $2}'
	done
}

mycurl(){
	sleep 0.5 && echo $(curl -s --request GET \
	"https://www.virustotal.com/vtapi/v2/file/report?apikey={{API_KEY}}&resource=${1}")
}

export -f getsums
export -f mycurl

getsums | parallel -a - -j8 --bar mycurl {} >> ${SUMMARY}
